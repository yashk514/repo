const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const app = express();
const PORT = 5000;
// cross origin resource sharing 
// http://localhost:3000 -> react
//  http://localhost:5000 -> backend 
// These are different origins, so the browser blocks requests by default.

// When React (3000) tries to call Node backend (5000), the browser blocks it unless CORS is enabled.
app.use(cors());
app.use(express.json());
// 1. What is app.use(express.json())?

// This line enables JSON body parsing in your Express server:

// app.use(express.json());


// Meaning:

// When your frontend sends JSON data in the request body, for example:

// { "name": "Yash", "age": 20 }


// The backend receives it as:

// req.body = { name: "Yash", age: 20 };


// Without express.json(), req.body will always be undefined.

// So this line is required whenever your API accepts JSON data via POST, PUT, PATCH, etc.


const MONGO_URL = 'mongodb://localhost:27017/cruddemo';
mongoose.connect(MONGO_URL)
    .then(()=>console.log('mongo  connected'))
    .catch(err=>console.error(err));
    // ()=> without argument arrow function with only one line 
    // err => with one argument 


const User = mongoose.model('User' , new mongoose.Schema({
    name : {type:String , required:true},
    email : {type : String , required :true , unique : true },
    age : Number 
}))

// routes

app.post('/users',async(req , res)=>{
    try{
        const user = await User.create(req.body);
        res.status(201).json(user);
    }catch(err)
    {
        res.status(400).json({error:err.message});
    }
})

app.get('/users', async(req,res)=>{
    const user = await User.find();
    res.json(user);
})

app.get('/users/:id' , async(req,res)=>{
    try{
        const user = await User.findById(req.params.id);
        res.status(201).json(user);
    }
    catch(err){
        res.status(400).json({error:err.message});
    }
})

app.put('/users/:id',async(req,res)=>{
    try{
        const user = await User.findByIdAndUpdate(req.params.id , req.body, {
            new : true
        });
        res.status(201).json(user);
    }
    catch(err)
    {
        res.status(400).json({error : err.message});
    }
})

app.delete('/users/:id' , async(req , res) =>{
    try
    {
        const user = await User.findByIdAndDelete(req.params.id);
        res.status(201).json(user);
    }
    catch(err){
        res.status(400).json({error : err.message});
    }

})







app.listen(PORT , ()=> console.log(`server running on http://localhost:${PORT}`));
